<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>Bazar Premium | Next Gen</title>
    
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <link href="https://fonts.googleapis.com/css2?family=Unbounded:wght@400;900&family=Manrope:wght@400;800&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/4.1.1/animate.min.css"/>
    
    <style>
        :root { 
            --accent: #00ffaa; 
            --bg: #030303; 
            --card: rgba(255, 255, 255, 0.03);
            --border: rgba(255, 255, 255, 0.08);
        }
        
        body { 
            font-family: 'Manrope', sans-serif; 
            background: var(--bg); 
            color: #fff; 
            overflow-x: hidden;
            background-image: radial-gradient(circle at 50% -20%, #00ffaa15, transparent);
        }

        .font-brand { font-family: 'Unbounded', sans-serif; }

        /* –≠—Ñ—Ñ–µ–∫—Ç –º–∞—Ç–æ–≤–æ–≥–æ —Å—Ç–µ–∫–ª–∞ */
        .glass { 
            background: var(--card); 
            backdrop-filter: blur(25px) saturate(180%); 
            -webkit-backdrop-filter: blur(25px) saturate(180%);
            border: 1px solid var(--border);
        }

        /* –ù–µ–æ–Ω–æ–≤–∞—è –∫–Ω–æ–ø–∫–∞ */
        .btn-prime {
            background: linear-gradient(135deg, var(--accent), #00d4ff);
            color: #000;
            font-weight: 800;
            box-shadow: 0 10px 30px -10px rgba(0, 255, 170, 0.5);
            transition: all 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
        }
        .btn-prime:active { transform: scale(0.95); }

        /* –ê–Ω–∏–º–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –≥—Ä–∞–¥–∏–µ–Ω—Ç –¥–ª—è —Ç–µ–∫—Å—Ç–∞ */
        .text-gradient {
            background: linear-gradient(to right, #fff, var(--accent));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }

        /* –ö–∞—Å—Ç–æ–º–Ω—ã–π —Å–∫—Ä–æ–ª–ª */
        ::-webkit-scrollbar { display: none; }

        /* –ê–Ω–∏–º–∞—Ü–∏—è –ø—É–ª—å—Å–∞—Ü–∏–∏ –¥–ª—è –æ–Ω–ª–∞–π–Ω-—Å—Ç–∞—Ç—É—Å–∞ */
        .pulse { animation: pulse-animation 2s infinite; }
        @keyframes pulse-animation {
            0% { box-shadow: 0 0 0 0px rgba(0, 255, 170, 0.4); }
            100% { box-shadow: 0 0 0 10px rgba(0, 255, 170, 0); }
        }

        /* –°–∫–µ–ª–µ—Ç–æ–Ω –∑–∞–≥—Ä—É–∑–∫–∞ */
        .skeleton {
            background: linear-gradient(90deg, #111 25%, #222 50%, #111 75%);
            background-size: 200% 100%;
            animation: skeleton-loading 1.5s infinite;
        }
        @keyframes skeleton-loading {
            0% { background-position: 200% 0; }
            100% { background-position: -200% 0; }
        }

        .category-chip { transition: 0.3s; cursor: pointer; border: 1px solid transparent; }
        .category-chip.active { background: var(--accent); color: #000; border-color: var(--accent); }

        .tab-bar-item { transition: 0.4s; opacity: 0.4; }
        .tab-bar-item.active { opacity: 1; color: var(--accent); transform: translateY(-3px); }
    </style>
</head>
<body class="safe-area-inset">

<div id="app" v-cloak>

    <!-- –ò–ù–î–ò–ö–ê–¢–û–† –ó–ê–ì–†–£–ó–ö–ò (SKELETON) -->
    <div v-if="loading" class="p-6 space-y-6">
        <div class="h-20 skeleton rounded-[2rem]"></div>
        <div class="grid grid-cols-2 gap-4">
            <div v-for="i in 4" class="h-60 skeleton rounded-[2.5rem]"></div>
        </div>
    </div>

    <div v-else class="animate__animated animate__fadeIn">
        
        <!-- üì¢ –ê–î–ú–ò–ù-–ë–ê–ù–ù–ï–† -->
        <div v-if="globalAlert" class="bg-gradient-to-r from-[#00ffaa] to-[#00d4ff] text-black text-[10px] font-black uppercase py-2 px-4 text-center tracking-[0.2em]">
            {{ globalAlert }}
        </div>

        <!-- üè∑Ô∏è –•–ï–î–ï–† –° –î–ê–®–ë–û–†–î–û–ú -->
        <header class="p-6">
            <div class="flex justify-between items-center mb-6">
                <div>
                    <h1 class="font-brand text-2xl font-black italic tracking-tighter leading-none">BAZAR<span class="text-[#00ffaa]">.</span></h1>
                    <div class="flex items-center gap-2 mt-1">
                        <span class="w-1.5 h-1.5 bg-[#00ffaa] rounded-full pulse"></span>
                        <span class="text-[9px] font-bold opacity-40 uppercase tracking-widest">{{ items.length }} —Ç–æ–≤–∞—Ä–æ–≤ –æ–Ω–ª–∞–π–Ω</span>
                    </div>
                </div>
                <div v-if="user" @click="view = 'profile'" class="w-12 h-12 rounded-2xl glass p-1 cursor-pointer">
                    <img :src="user.avatar || `https://api.dicebear.com/7.x/pixel-art/svg?seed=${user.name}`" class="w-full h-full object-cover rounded-xl">
                </div>
                <button v-else @click="view = 'auth'" class="btn-prime px-6 py-2 rounded-xl text-[10px] uppercase">–í–æ–π—Ç–∏</button>
            </div>

            <!-- üî• –ì–û–†–Ø–ß–ò–ï –ü–†–ï–î–õ–û–ñ–ï–ù–ò–Ø (SLIDER) -->
            <div v-if="view === 'home'" class="flex gap-4 overflow-x-auto pb-4 -mx-2 px-2">
                <div v-for="item in items.slice(0,3)" @click="openItem(item)" 
                    class="min-w-[280px] h-40 glass rounded-[2.5rem] relative overflow-hidden flex-shrink-0 p-6 flex flex-col justify-end">
                    <img :src="item.img" class="absolute inset-0 w-full h-full object-cover opacity-30 grayscale">
                    <div class="relative z-10">
                        <span class="bg-[#00ffaa] text-black text-[8px] font-black px-2 py-1 rounded mb-2 inline-block">HOT DEAL</span>
                        <h4 class="font-brand text-sm uppercase truncate">{{item.title}}</h4>
                        <p class="text-[#00ffaa] font-black text-lg">{{item.price}} ‚ÇΩ</p>
                    </div>
                </div>
            </div>
        </header>

        <main class="px-6 pb-32">
            <!-- –í–ò–¢–†–ò–ù–ê -->
            <div v-if="view === 'home'">
                <!-- –ü–æ–∏—Å–∫ –∏ –§–∏–ª—å—Ç—Ä—ã -->
                <div class="sticky top-4 z-40 mb-8 space-y-4">
                    <div class="glass rounded-[2rem] flex items-center px-6 py-1">
                        <span class="opacity-30">üîç</span>
                        <input v-model="searchQuery" type="text" placeholder="–ù–∞–π—Ç–∏ –¥–µ–≤–∞–π—Å..." class="bg-transparent border-none w-full p-4 text-sm focus:ring-0">
                    </div>
                    <div class="flex gap-2 overflow-x-auto no-scrollbar">
                        <div v-for="c in categories" @click="filters.cat = c" 
                            :class="['category-chip px-6 py-3 rounded-full text-[10px] font-black uppercase whitespace-nowrap glass', {active: filters.cat === c}]">
                            {{c}}
                        </div>
                    </div>
                </div>

                <!-- –°–ï–¢–ö–ê (Pinterest Style) -->
                <div class="columns-2 gap-4 space-y-4">
                    <div v-for="item in sortedItems" :key="item.id" @click="openItem(item)" 
                        class="glass rounded-[2.5rem] p-3 break-inside-avoid relative group">
                        
                        <div class="relative rounded-[1.8rem] overflow-hidden mb-3 bg-black">
                            <img :src="item.img" class="w-full h-auto object-cover group-hover:scale-110 transition-transform duration-700">
                            <div v-if="item.status === 'sold'" class="absolute inset-0 bg-black/70 flex items-center justify-center">
                                <span class="border-2 border-red-500 text-red-500 px-3 py-1 rounded-xl text-[10px] font-black -rotate-12">SOLD</span>
                            </div>
                            <div class="absolute top-2 left-2 flex gap-1">
                                <span v-if="userMap[item.user_id]?.is_verified" class="bg-blue-500 text-white p-1 rounded-lg text-[10px]">‚úÖ</span>
                            </div>
                        </div>

                        <div class="px-2">
                            <h3 class="text-[11px] font-black uppercase leading-tight mb-1 truncate">{{item.title}}</h3>
                            <div class="flex justify-between items-center">
                                <span class="text-[#00ffaa] font-brand text-[12px] font-black">{{item.price}} ‚ÇΩ</span>
                                <span class="text-[8px] opacity-30 font-bold uppercase">{{item.city}}</span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- –ü–†–û–°–ú–û–¢–† –õ–û–¢–ê (Glass Card) -->
            <div v-else-if="view === 'product' && selectedItem" class="max-w-xl mx-auto animate__animated animate__fadeInUp">
                <button @click="view = 'home'" class="mb-6 opacity-30 text-xs font-black uppercase tracking-widest">‚Üê –ù–∞–∑–∞–¥</button>
                
                <div class="glass rounded-[3.5rem] overflow-hidden">
                    <div class="relative h-[400px]">
                        <img :src="activeImg || selectedItem.img" class="w-full h-full object-cover">
                        <div class="absolute bottom-6 left-1/2 -translate-x-1/2 flex gap-2">
                            <div v-for="p in [selectedItem.img, selectedItem.img2, selectedItem.img3].filter(x=>x)" 
                                 @click="activeImg = p"
                                 :class="['w-2 h-2 rounded-full transition-all', activeImg === p ? 'bg-[#00ffaa] w-6' : 'bg-white/20']"></div>
                        </div>
                    </div>
                    
                    <div class="p-8">
                        <div class="flex justify-between items-start mb-6">
                            <div>
                                <h2 class="text-3xl font-brand font-black uppercase italic tracking-tighter">{{selectedItem.title}}</h2>
                                <p class="text-[#00ffaa] text-sm font-black uppercase mt-1">{{selectedItem.category}}</p>
                            </div>
                            <div class="text-2xl font-brand font-black text-gradient">{{selectedItem.price}} ‚ÇΩ</div>
                        </div>

                        <div class="flex items-center gap-4 p-4 glass rounded-3xl mb-8">
                            <img :src="userMap[selectedItem.user_id]?.avatar" class="w-12 h-12 rounded-xl object-cover">
                            <div class="flex-1">
                                <div class="text-[10px] font-black uppercase flex items-center gap-2">
                                    {{selectedItem.seller_name}}
                                    <span v-if="userMap[selectedItem.user_id]?.has_crown">üëë</span>
                                </div>
                                <div class="text-[8px] opacity-40 uppercase font-bold tracking-widest">–ü—Ä–æ–≤–µ—Ä–µ–Ω–Ω—ã–π –ø—Ä–æ–¥–∞–≤–µ—Ü</div>
                            </div>
                            <button @click="contactSeller" class="btn-prime p-3 rounded-xl">üí¨</button>
                        </div>

                        <p class="text-gray-400 text-sm leading-relaxed mb-10">{{selectedItem.desc_text}}</p>
                        
                        <button @click="contactSeller" :disabled="selectedItem.status === 'sold'" 
                                class="btn-prime w-full py-6 rounded-[2rem] text-xs font-black uppercase tracking-[0.3em]">
                            –°–≤—è–∑–∞—Ç—å—Å—è –≤ Telegram
                        </button>
                    </div>
                </div>
            </div>

            <!-- [–°–ï–ö–¶–ò–ò PROFILE –ò ADMIN –û–°–¢–ê–Æ–¢–°–Ø –ò–ó –ü–†–û–®–õ–û–ì–û –û–¢–í–ï–¢–ê –° –¢–ï–ú –ñ–ï –°–¢–ò–õ–ï–ú] -->

        </main>

        <!-- üïπÔ∏è –¢–ê–ö–¢–ò–õ–¨–ù–´–ô –¢–ê–ë-–ë–ê–† -->
        <nav class="fixed bottom-8 inset-x-8 z-[100] max-w-sm mx-auto">
            <div class="glass rounded-[2.5rem] p-3 flex justify-around items-center shadow-[0_20px_50px_rgba(0,0,0,0.5)]">
                <button @click="view = 'home'" :class="['tab-bar-item p-3', {active: view === 'home'}]">
                    <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2.5" d="M3 12l2-2m0 0l7-7 7 7M5 10v10a1 1 0 001 1h3m10-11l2 2m-2-2v10a1 1 0 01-1 1h-3m-6 0a1 1 0 001-1v-4a1 1 0 011-1h2a1 1 0 011 1v4a1 1 0 001 1m-6 0h6"/></svg>
                </button>
                <button @click="user ? view = 'add' : view = 'auth'" :class="['tab-bar-item p-3', {active: view === 'add'}]">
                    <div class="bg-[#00ffaa] text-black rounded-2xl p-2 shadow-[0_0_20px_rgba(0,255,170,0.5)]">
                        <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="3" d="M12 4v16m8-8H4"/></svg>
                    </div>
                </button>
                <button @click="user ? view = 'profile' : view = 'auth'" :class="['tab-bar-item p-3', {active: view === 'profile' || view === 'admin'}]">
                    <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2.5" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"/></svg>
                </button>
            </div>
        </nav>
    </div>
</div>

<script>
// –¢–µ –∂–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ Supabase –∏ —Å–∫—Ä–∏–ø—Ç, –Ω–æ –¥–æ–±–∞–≤–∏–º –ø–æ–ª–µ globalAlert
const { createApp } = Vue;
// ... (–ö–æ–Ω—Å—Ç–∞–Ω—Ç—ã —Ç–µ –∂–µ)

createApp({
    data() {
        return {
            loading: true, view: 'home',
            globalAlert: 'üöÄ –°–ö–ò–î–ö–ê –ù–ê –ü–†–ï–ú–ò–£–ú-–ê–ö–ö–ê–£–ù–¢–´ –î–û –ö–û–ù–¶–ê –ù–ï–î–ï–õ–ò!',
            // ... (–æ—Å—Ç–∞–ª—å–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ –∏–∑ –ø—Ä–æ—à–ª–æ–≥–æ –∫–æ–¥–∞)
        }
    },
    // ... (–í—Å–µ –º–µ—Ç–æ–¥—ã –∏–∑ –ø—Ä–æ—à–ª–æ–≥–æ –∫–æ–¥–∞)
    methods: {
        // –î–æ–±–∞–≤–∏–º –∫—Ä–∞—Å–∏–≤—ã–π —Å–∫—Ä–æ–ª–ª –≤–≤–µ—Ä—Ö –ø—Ä–∏ –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–∏
        openItem(item) {
            this.selectedItem = item;
            this.activeImg = item.img;
            this.view = 'product';
            window.scrollTo({ top: 0, behavior: 'smooth' });
        },
        // ...
    }
}).mount('#app')
</script>
</body>
</html>
